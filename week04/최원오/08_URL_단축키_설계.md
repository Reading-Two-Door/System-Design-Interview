# URL 단축키 설계

## 1단계 문제 이해 및 설계 범위 확정

1. URL 단축
2. URL 리디렉션
3. 높은 가용성과 규모 확장성, 장애 감내

## 2단계 개략적 설계안 제시 및 동의 구하기

### API 엔드포인트

- 클라이언트는 서버가 제공하는 API 엔드포인트를 통해 서버와 통신
- URL 단축키는 기본적으로 두 개의 엔드포인트가 필요
  1. URL 단축용 엔드포인트 - 새 단축 URL을 생성하고자 하는 클라이언트는 이 엔드포인트에 단축할 URL을 인자로 실어서 POST요청을 보내야 한다.
  2. URL 리디렉션용 엔드포인트 - 단축 URL에 대해서 HTTP요청이 오면 원래 URL로 보내주기 위한 용도의 엔드포인트

### URL 리디렉션

- 단축 URL을 받은 서버는 그 URL을 원래 URL로 바꾸어서 301응답의 Location 헤더에 넣어 반환
- 301 응답 - HTTP 요청의 처리 책임이 영구적으로 Location헤더에 반환된 URl로 이전되었다는 응답, 영구적으로 이전되었으므로, 브라우저는 이 응답을 캐시
- 302 응답 - 일시적으로 Location 헤더가 지정하는 URL에 의해 처리되어햐 한다는 응답으로 언제나 단축 URL 서버를 거쳐 원래 URL로 리디렉션
- 서버 부하를 위해서는 301응답이 좋으나 트래픽 분석이 중요할 때는 302응답이 유리
- URL 리디렉션을 구현하는 가장 직관적인 방법은 해시 테이블을 사용하는 것

### URL 단축

- 긴 URL을 해시 값으로 대응시킬 수 있는 함수 fx를 찾는 일
- 입력으로 주어지는 긴 URL이 다른 값이면 해시 값도 달라야한다.
- 계산된 해시 값은 원래 입력으로 복원 가능해야한다.

## 3단계 상세 설계

### 데이터 모델

- 해시테이블은 초기 전략으로는 괜찮지만 실제 시스템에 사용하기는 메모리가 유한하고 비싸기 떄문에 곤란
- 더 나은 방법은 순서쌍을 관계형 데이터베이스에 저장하는 것(id, shortURL, longURL을 컬럼으로 가짐)

### 해시 함수

- 해시 함수는 원래 URL을 단축 URL로 변환하는데 쓰인다.
- hashValue는 [0-9, a-z, A-Z]의 문자들로 구성된다. 62^n

해시 후 충돌 해소

- 계산된 해시 값에서 처음 7개 글자만 이용
- 충돌이 발생하면 충돌이 해소될 때 까지 사전에 정한 문자열을 해시값에 덧붙인다.
- 충돌은 해소할 수 있으나 단축 URL 생성 시 한 번 이상의 데이터베이스 질의를 해야 하므로 오버헤드가 크다.

base-62 변환

- 진법 변환은 URL 단축키를 구현할 때 흔히 사용되는 접근법
- 수의 표현 방식이 다른 두 시스템이 같은 수를 공유하여야 하는 경우에 유용
- 충돌이 발생하지 않지만 보안상 문제가 될 소지가 있다

### URL 단축키 상세 설계

- URL 단축키는 시스템의 핵심 컴포넌트이므로, 처리 흐름이 논리적으로는 단순해야 하고 기능적으로는 언제나 동작하는 상태로 유지되어야 한다.
- ID 생성기는 단축 URL을 만들 때 사용할 ID를 만드는 것이고, 이 ID는 전역적 유일성이 보장되는 것이여야한다.

### URL 리디렉션 상세 설계

- 쓰기보다 읽기를 자주하는 시스템이기에 <단축 URL, 기존 URL>의 쌍을 캐싱해 성능을 높일 수 있다.

## 4단계 마무리

추가 설계 사항

- 처리율 제한 장치
- 웹 서버의 규모 확장
- 데이터베이스의 규모 확장
- 데이터 분석 솔루션
- 가용성, 데이터 일관성, 안정성
