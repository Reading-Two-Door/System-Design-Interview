# 뉴스 피드 시스템 설계

## 1단계 문제 이해 및 설계 범위 확정

## 2단계 개략적 설계안 제시 및 동의 구하기

- 포스팅 저장 서비스 - 새 포스팅을 데이터베이스와 캐시에 저장
- 포스팅 전송 서비스 - 새 포스팅을 친구의 뉴스 피드에 푸시
- 알림서비스 - 새 포스팅이 올라왔음을 알리거나, 푸시 알림을 보내는 역할 담당

## 3단계 상세 설계

웹 서버

- 인증이나 처리율 제한 기능도 수행
- 올바른 인증 토큰을 Authorization 헤더에 넣고 API를 호출하는 사용자만 포스팅을 할 수 있어야 한다.
- 유해한 콘텐츠가 자주 올라오는 것을 방지하기 위해 특정 기간 동안 같은 유저가 올릴 수 있는 포스팅의 수에 제한

포스팅 전송 서비스

- 사용자의 새 포스팅을 그 사용자와 친구 관계에 있는 모든 사용자에게 전달하는 과정
- 쓰기 시점 팬아웃 - 포스팅이 완료되면 바로 해당 사용자의 캐시에 해당 포스팅을 기록
  - 장점
    - 실시간 갱신
    - 뉴스 피드를 읽는 시간이 짧아진다
  - 단점
    - 친구가 많은 유저의 경우 많은 시간 소요 (핫키)
    - 서비스를 자주 이용하지 않는 유저의 피드도 갱신해야해 자원 낭비
- 읽기 시점 팬아웃 - 사용자가 본인 홈페이지나 타임라인을 로딩하는 시점에 새로운 포스트 가져옴
  - 장점
    - 비활성화된 유저가 로그인하기전까지 컴퓨팅 자원 소모 안함
    - 데이터를 친구 각각에 푸시하는 작업이 필요 없으므로 핫키 문제가 발생하지 않음
  - 단점
    - 뉴스피드 읽기에 많은 시간이 소요될 수 있음
- 일반적으로는 쓰기 시점 팬아웃을 하고 친구가 많은 유저의 경우 읽기 시점으로 하여 시스템 과부하를 방지
- 안정 해시를 통해 요청과 데이터를 보다 고르게 분산하여 핫키 문제를 줄일 수 있다.
