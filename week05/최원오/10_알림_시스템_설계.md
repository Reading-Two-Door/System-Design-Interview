# 알림 시스템 설계

- 알림 시스템은 푸시 알림, SMS 메세지, 이메일 세 가지로 분류할 수 있다.

## 1단계 문제 이해 및 설계 범위 확정

## 2단계 개략적 설계안 제시 및 동의 구하기

### 알림 유형별 지원 방안

IOS 푸시 알림

- 알림 제공자(provider): 알림 요청을 만들어 애플 푸시 알림 서비스로 보내는 주체
  - 단말 토큰 - 고유 식별자
  - 페이로드 - 알림 내용 JSON
  - APNS - 애플이 제공하는 원격 서비스
  - IOS단말 - 기기

안드로이드 푸시 알림

- FCM

SMS 메시지

- 트윌리오, 넥스모 같은 제3 사업자 서비스

이메일

- 대부분의 회사는 고유 이메일 서버를 구축할 역량을 갖추고 있으나 사용 이메일 서비스를 이용
- 전송 성공률이 높고, 데이터 분석 서비스를 제공하기 떄문

### 연락처 정보 수집 절차

- 알림을 보내기 위해서는 단말 토큰, 전화번호, 이메일 등의 정보가 필요
- 앱을 설치하거나 계정 등록 시 사용자의 정보를 수집하여 데이터베이스에 저장
- 한 사용자가 여러 단말을 가질 수 있음을 고려

### 알림 전송 및 수신 절차

- 1부터 N까지의 서비스 - 마이크로서비스, 크론잡, 분산 시스템 컴포넌트
- 알림 시스템 - 서비스 1~N에 알림 전송을 위한 API를 제공해야 하고, 제3자 서비스에 전달할 알림 페이로드를 만들어 낼 수 있어야한다.
- 제3자 서비스 - 새로운 서비스를 통합하거나 기존 서비스를 제거할 수 있어야 한다.

## 3단계 상세 설계

- 안정성
- 추가 컴포넌트 및 고려사항 - 알림 템플릿, 알림 설정, 전송률 제한, 재시도 메커니즘, 보안, 큐에 보관된 알림 모니터링과 이벤트 추적
- 개선된 설계안

### 안정성

데이터 손실 방지

- 알림 전송 시스템의 가장 중요한 요구사항 가운데 하나는 어떤 상황에서도 알림이 소실되면 안 된다는 것
- 알림 데이터를 데이터베이스에 보관하고 재시도 메커니즘을 구현해야한다.

알림 중복 전송 방지

- 같은 알림이 여러 번 반복되는 것을 완전히 막는 것은 가능하지 않다.
- 보내야 할 알림이 도착하면 이벤트 ID를 검사해 중복된 이벤트를 확인

### 추가로 필요한 컴포넌트 및 고려사항

알림 템플릿

- 알림 템플릿은 유사성을 고려해, 알림 메시지의 모든 부분을 처음부터 다시 만들 필요 없도록 한다.
- 파라미터나 스타일, 추적 링크를 조정하기만 하면 사전에 지정한 형식에 맞춰 알람을 만들어 내는 틀

알림 설정

- 유저는 알림에 피곤함을 느끼기에 상세히 알림을 설정 할 수 있도록 해야한다.
- channel, opt_in(수신 여부)

전송률 제한

- 사용자가 받을 수 있는 알림의 빈도를 제한

재시도 방법

- 제 3자 서비스가 알림 전송에 실패하면, 해당 알림을 재시도 전용 큐에 넣는다
- 같은 문제가 발생 시 개발자에게 통지

푸시 알림과 보안

- ios와 안드로이드의 경우, appKey와 appSecret을 사용하여 보안을 유지한다.

큐 모니터링

- 큐에 쌓인 알림의 개수

이벤트 추적

- 알림 확인율, 클릭율, 실제 앱 사용으로 이어지는 비율 같은 메트릭은 사용자을 이해하는데 중요

## 4단계 마무리

- 안정성
- 보안
- 이벤트 추적 및 모니터링
- 사용자 설정
- 전송률 제한
